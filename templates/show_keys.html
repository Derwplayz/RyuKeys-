{% extends "base.html" %}

{% block content %}
<div class="card">
    <div style="font-size:1.35em;color:#1a75ff;margin-bottom:0.5em;font-weight:bold;text-shadow: 0 0 10px rgba(26, 117, 255, 0.5);">
        <i class="fas fa-key"></i> Your Keys
    </div>
    
    <div style="color:#fff;opacity:0.78;margin-bottom:1.5em;line-height:1.4;text-align:center;">
        Keys associated with IP: <code style="background: rgba(40, 40, 40, 0.6); padding: 2px 6px; border-radius: 4px;">{{ current_ip }}</code>
    </div>

    {% if keys %}
        <div style="margin-bottom: 1.5em;">
            <div style="color: #1a75ff; font-weight: bold; margin-bottom: 1em; text-align: center;">
                Found {{ keys|length }} key(s)
            </div>
            
            {% for key in keys %}
            <div style="background: rgba(20, 20, 20, 0.6); padding: 1em; border-radius: 0.5em; border: 1px solid rgba(26, 117, 255, 0.3); margin-bottom: 1em;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5em;">
                    <div>
                        <strong style="color: #1a75ff; font-size: 1.1em;">{{ key.code }}</strong>
                        <span class="status-badge {% if key.used %}status-used{% else %}status-active{% endif %}" style="margin-left: 10px;">
                            {% if key.used %}<i class="fas fa-times-circle"></i> Used{% else %}<i class="fas fa-check-circle"></i> Active{% endif %}
                        </span>
                    </div>
                    <button onclick="copyToClipboard('{{ key.code }}')" class="menu-item action-btn" style="border: none; cursor: pointer; padding: 0.3em 0.6em; font-size: 0.8em;">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                </div>
                
                {% if key.claimed_at %}
                <div style="color: #b4b9c6; font-size: 0.8em;">
                    <div><strong>Claimed:</strong> {{ key.claimed_at }}</div>
                    {% if key.claimed_by %}
                    <div><strong>By:</strong> {{ key.claimed_by }}</div>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; color: #ff6666; padding: 2em;">
            <i class="fas fa-key" style="font-size: 2em; margin-bottom: 0.5em;"></i>
            <div>No keys found for your IP address</div>
        </div>
    {% endif %}

    <div style="display: flex; gap: 1em; justify-content: center; margin-top: 1.5em;">
        <a href="{{ url_for('key_management') }}" style="text-decoration: none;">
            <button class="progress-btn" style="background: linear-gradient(135deg, #1a75ff, #0052cc);">
                <i class="fas fa-arrow-left"></i> Back
            </button>
        </a>
        <a href="{{ url_for('clear_keys') }}" style="text-decoration: none;">
            <button class="progress-btn" style="background: linear-gradient(135deg, #ff6b6b, #ee5a52);">
                <i class="fas fa-trash-alt"></i> Clear Keys
            </button>
        </a>
    </div>
</div>

<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        // Optional: Show a temporary notification
        const originalText = event.target.innerHTML;
        event.target.innerHTML = '<i class="fas fa-check"></i> Copied!';
        setTimeout(() => {
            event.target.innerHTML = originalText;
        }, 2000);
    });
}
</script>

<style>
.status-badge {
    padding: 3px 8px;
    border-radius: 10px;
    font-size: 0.8em;
    font-weight: bold;
    display: inline-block;
}

.status-active {
    background: rgba(0, 255, 0, 0.2);
    color: #00ff00;
    border: 1px solid rgba(0, 255, 0, 0.3);
}

.status-used {
    background: rgba(255, 0, 0, 0.2);
    color: #ff6666;
    border: 1px solid rgba(255, 0, 0, 0.3);
}
</style>
{% endblock %}