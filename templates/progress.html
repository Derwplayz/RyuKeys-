{% extends "base.html" %}
{% block content %}
<div class="step-card">
  {{ nav|safe }}
  <div class="step-title">Step {{ level }} of {{ max_level }}</div>
  
  <!-- YouTube Video Embed -->
  <div style="margin-bottom:1.5em;">
    <div style="color:#1a75ff; font-weight:bold; margin-bottom:0.5em; text-align:center;">
      <i class="fab fa-youtube"></i> How to Complete This Step
    </div>
    <div class="video-container">
      <iframe 
        src="https://www.youtube.com/embed/oSR9XubbGs4" 
        title="How to Complete Sponsor Steps" 
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
        allowfullscreen>
      </iframe>
    </div>
    <div style="color:#66a3ff; font-size:0.9em; text-align:center; margin-top:0.5em;">
      Watch this video to learn how to complete the sponsor steps correctly
    </div>
  </div>

  <div style="margin-bottom:1.2em;line-height:1.4;">1. Choose a sponsor to start the task (opens in new tab):</div>
  <div style="display:flex;justify-content:center;gap:0.7em;flex-wrap:wrap;">
    {{ sponsor_buttons|safe }}
  </div>
  <div class="progress-bar-bg"><div class="progress-bar-fill" style="width: 0%;"></div></div>
  <div style="margin:1.3em 0 0.5em 0;">
    {{ claim_btn_html|safe }}
  </div>
  <div style="color:#66a3ff;font-size:0.98em;line-height:1.3;">
    After visiting a sponsor, come back to this page to continue.
  </div>
</div>

<style>
  .video-container {
    position: relative;
    width: 100%;
    height: 0;
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
    margin: 0.5em 0 1em 0;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3), 0 0 15px rgba(26, 117, 255, 0.2);
    border: 1px solid rgba(26, 117, 255, 0.3);
  }
  .video-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
    border-radius: 12px;
  }

  @media (max-width: 480px) {
    .step-card .progress-btn {
      margin: 0.5em 0.3em !important;
    }
    
    .video-container {
      margin: 0.3em 0 0.8em 0;
      border-radius: 8px;
    }
    
    .video-container iframe {
      border-radius: 8px;
    }
  }

  @media (max-width: 360px) {
    .video-container {
      margin: 0.2em 0 0.6em 0;
    }
  }
</style>

<script>
// Animate progress bar when page loads
document.addEventListener('DOMContentLoaded', function() {
  const currentLevel = {{ level }};
  const maxLevel = {{ max_level }};
  const progressBar = document.querySelector('.progress-bar-fill');
  
  if (progressBar) {
    // Animate the progress bar
    setTimeout(() => {
      progressBar.style.width = (100 * (currentLevel - 1) / maxLevel) + "%";
    }, 100);
  }
  
  // Animate step dots
  const dots = document.querySelectorAll('.step-dot');
  dots.forEach((dot, i) => {
    if(i + 1 < currentLevel) dot.classList.add("done");
    if(i + 1 == currentLevel) dot.classList.add("active");
    if(i + 1 > currentLevel) dot.classList.add("locked");
  });
});
</script>
{% endblock %}